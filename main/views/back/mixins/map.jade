mixin map()
	div#mymap
	script

		/*INIT*/
		var conf = !{conf};
		var logged = 0;

		var curPos = {'x':0,'y':0,'z':0};
		var geolocalized = 0;
		var infowindow = null;
		var bounds = new Array();
		var markers = [];
		var infoArray = [];
		var markerLocation = null;

		
		var heat = 3;
		//var type = [1];
		var type = [!{type}];

		var infoContent = '';
		var rule = new RegExp('#([^\\s]*)','g');
		var rule2 = new RegExp('[#]','g');
		var postFlag = 0;
		var listenerHandle = null;

		/*READY FUNCTIONS*/
		$(document).ready(function() {

			

			$('#mymap').css('width',($(window).width() - $('#newsfeedContainer').width())-20);

			// init news feed (Setting the scroll bar)
			drawNewsFeed();

			$('#newsfeedContainer').mCustomScrollbar({mouseWheel:true,scrollButtons:{enable:true,scrollType:"continuous",},advanced:{autoExpandHorizontalScroll:true,updateOnContentResize: true,updateOnBrowserResize:true}});
			$(window).resize(function(){drawNewsFeed();});

			$('#newsfeed').delegate(".mapHighlighter",'click', function () {
				unhighlightInfo($(this),highlightInfo);
			});

			/*cookies for navigation*/
			if($.cookie("geoloc")){
				curPos = JSON.parse($.cookie("geoloc"));
				google.maps.event.addDomListener(window, 'load', initialize(curPos.x,curPos.y,curPos.z));
			}else{
				if(navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(getHTML5Pos,getErrHTML5Pos);
				}else {
					x = 48.851875;
					y = 2.356374;
					z = 13;
					curPos = {'x':x,'y':y,'z':z};
					google.maps.event.addDomListener(window, 'load', initialize(curPos.x,curPos.y,curPos.z));
				}
			}


			markerLocation = new google.maps.Marker({
				visible:false,
				map:map,
				draggable:true,
				icon:'/images/back/marker1.png',
			});


			

		});/*END READY*/

		function drawNewsFeed(){
			$('#mymap').css('width',($(window).width() - $('#newsfeedContainer').width())-20);
			var newsfeedContainerHeight = window.innerHeight-$('#newsfeedContainer').offset().top-10+'px';
			$('#newsfeedContainer').css('height',newsfeedContainerHeight);
		}

		function initialize(x,y,z){

			// set user cookies
			$.cookie("geoloc", JSON.stringify(curPos),{ expires: 10000 });
			//console.log(JSON.parse($.cookie("geoloc")));

			var center = new google.maps.LatLng(x,y);
			infowindow = new google.maps.InfoWindow({content: ".",maxWidth : 300});
			map = new google.maps.Map(document.getElementById('mymap'), {
				zoom: z,
				center: center,
				mapTypeId: google.maps.MapTypeId.ROADMAP,
				panControl: false,
				scaleControl: false,
				streetViewControl: false,
				zoomControl: true,
				zoomControlOptions: {
					style: google.maps.ZoomControlStyle.LARGE,
					position: google.maps.ControlPosition.LEFT_BOTTOM
				},
			});

			
			markerHL = new google.maps.Marker({position: center,map:map,visible:false});

			google.maps.event.addListenerOnce(map, 'idle', function(){
				bounds = this.getBounds();
				//getAndPrintInfo();

			});


			google.maps.event.addListener(map, 'dragend', function() {
				bounds = this.getBounds();
				center = this.getCenter();
				curPos.x = center.lat();
				curPos.y = center.lng();
				$.cookie("geoloc", JSON.stringify(curPos));
				//getAndPrintInfo();
			});

			google.maps.event.addListener(map, 'zoom_changed', function() {
				bounds = this.getBounds();
				curPos.z = this.getZoom();
				$.cookie("geoloc", JSON.stringify(curPos));
				//getAndPrintInfo();
			});
		}