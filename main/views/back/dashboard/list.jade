mixin list()
	div.span6
		legend GÃ©olocalisation des infos :
		div#chart_geo(style="width: 100%; height: 100%;")	
		br
		br
		legend Etat des batchs :
		table.table#batchList.table-hover

	div.span6
		div#chart_info(style="width: 75%; height: 100%;")	
		div#chart_place(style="width: 75%; height:100%;")
		div#chart_user(style="width: 75%; height: 100%;")				
	script

		/*BATCH LIST*/
		$.get('/api/feedList',function(data){
			if(typeof data.feeds != 'undefined' && data.feeds.length > 0){	
				var batchsInError = '';
				data.feeds.forEach(function(item){
					if(item.lastExecStatusLabel != 'OK'){
						batchsInError += '<tr><td><i class="icon-exclamation-sign"></i>&nbsp;'+item.humanName+'</td><td>Last Execution : '+item.lastExecDate+'</td><td class="error">'+item.lastExecStatusLabel+'</td></tr>';
					}
				});
				if(batchsInError.length == 0)
					$("#batchList").append('<tr><td>Tous les batchs sont OK !</td></tr>');
				else
					$("#batchList").append(batchsInError);		
			}
			
		});
		

		/*LINECHART*/
		var last10Days = new Date() - 10*24*60*60*1000;
		google.load("visualization", "1", {packages:["corechart"]});
		google.setOnLoadCallback(drawChart);
		function drawChart() {
			var option = {};
			var data = {};
			var mapData = {};
	
			$.get('/api/dashboard/statsByDate/info/'+last10Days,function(rows){
				
				data['cols'] = [
								{id: 'creationDate', label: 'Date', type: 'string'},
								{id: 'infoTotal', label: 'Total Infos', type: 'number'},
								{id: 'infoYassala', label: 'Yassalas', type: 'number'},
								{id: 'infoTovalidate', label: 'To Validate', type: 'number'},
							];
				data['rows'] = rows;			
				mapData = new google.visualization.DataTable(data)
				options = {title: 'Infos',colors:['#3a87ad','#468847','#b94a48','#f89406'],areaOpacity:0.6};
				var chartInfo = new google.visualization.AreaChart(document.getElementById('chart_info'));
				chartInfo.draw(mapData, options);
			});
				
			$.get('/api/dashboard/statsByDate/user/'+last10Days,function(rows){	
				data = {};
				mapData = {};
				data['cols'] = [
								{id: 'creationDate', label: 'Date', type: 'string'},
								{id: 'userTotal', label: 'Total Users', type: 'number'},
								{id: 'userTovalidate', label: 'To Validate', type: 'number'},
							];
				data['rows'] = rows;			
				mapData = new google.visualization.DataTable(data)
				options = {title: 'Users',colors:['#3a87ad','#468847','#b94a48','#f89406'],areaOpacity:0.8};
				var chartUser = new google.visualization.AreaChart(document.getElementById('chart_user'));
				chartUser.draw(mapData, options);
			});
			$.get('/api/dashboard/statsByDate/place/'+last10Days,function(rows){		
				data = {};
				mapData = {};
				data['cols'] = [
								{id: 'creationDate', label: 'Date', type: 'string'},
								{id: 'placeTotal', label: 'Total Lieux', type: 'number'},
								{id: 'placeTovalidate', label: 'To Validate', type: 'number'},
							];
				data['rows'] = rows;			
				mapData = new google.visualization.DataTable(data)
				options = {title: 'Lieux',colors:['#3a87ad','#468847','#b94a48','#f89406'],areaOpacity:0.4};
				var chartPlace = new google.visualization.AreaChart(document.getElementById('chart_place'));
				chartPlace.draw(mapData, options);
			});
		};

		/*GEOCHART*/
		google.load('visualization', '1', {'packages': ['geochart']});
		google.setOnLoadCallback(drawMarkersMap);

		function drawMarkersMap() {
			var nowTs = parseInt(new Date().getTime());
			$.get('/api/dashboard/statsByZone/'+nowTs,function(rows){
				var mapData = {};
				data = {};
				data['cols'] = [
								{id: 'Zone', label: 'Zone', type: 'string'},
								{id: 'nbinfos', label: 'Infos: ', type: 'number'},
							];

				data['rows'] = rows;
				mapData = new google.visualization.DataTable(data)
				
				var options = {
				
					region: 'FR',
					displayMode: 'markers',
					colorAxis: {colors: ['#3A87AD', '#b94a48']}
				};

				var chart = new google.visualization.GeoChart(document.getElementById('chart_geo'));
				chart.draw(mapData, options);
			});	
		};


		