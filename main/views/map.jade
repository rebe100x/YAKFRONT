include mixins/menu.jade

mixin menu('elo')

div.container-fluid
	div.row-fluid
		div.span3
		div.span9
			div#mymap
            

	script
		var infowindow = null;

		function initialize() {
			var center = new google.maps.LatLng(48.857939,2.353477);

			infowindow = new google.maps.InfoWindow({content: ".",maxWidth : 300});

			var map = new google.maps.Map(document.getElementById('mymap'), {
				zoom: 10,
				center: center,
				mapTypeId: google.maps.MapTypeId.ROADMAP
			});
	
			var markers = [];
			$.getJSON('/api/info',function(data) {
			//console.log(data.info[0].location);
				var items = [];
				$.each(data.info, function(key,val) {
				//console.log(val);
					
					
					var latLng = new google.maps.LatLng(val.location['lat'],val.location['lng']);
					var marker = new google.maps.Marker({position: latLng});
					markers.push(marker);
					
					google.maps.event.addListener(marker, 'click', function() {
						//map.setZoom(8);
						//map.setCenter(marker.getPosition());
						var infoContent = "<div class=\'infowindow\' ><img src=\'http://dev.backend.yakwala.com/BACKEND/"+val.thumb+"\' /><div class=\'title\'> "+val.title+"</div><div class=\'content\'>"+val.content.substring(0,250)+"...</div><div class=\'readmore\'><a target=\'_blank\' href=\'"+val.outGoingLink+"\'> Read more</a></div></div>";
						infowindow.setContent(infoContent);
						infowindow.open(map, this);
					});	
					
				});
				var markerClustererOptions = {gridSize:60,maxZoom: 16};
				var markerCluster = new MarkerClusterer(map, markers,markerClustererOptions);
				
				google.maps.event.addListener(markerCluster, 'click', function(data) {
					console.log('data'+data);
				});
			});
			
			
		}
		
		google.maps.event.addDomListener(window, 'load', initialize); 
