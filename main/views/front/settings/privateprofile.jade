extends ../layout
block content

	include ../mixins/menu.jade
	include ../mixins/locationChooser.jade
	include ../mixins/forms/privateprofileForm.jade
	include ../mixins/settingsMenu.jade
	
	mixin menu('privateprofile')
	mixin locationChooser()

	div.container-fluid
		div.row-fluid
			div.span3.yak-sidebar
				mixin settingsMenu('privateprofile') 

						
			div.span8
				- if (message)
					div.alert.fade.in
						button.close(type="button",data-dismiss="alert") x
						strong=message
				div.content-header
					div.header-inner
						h2 Mon profil privé
						p.subheader Ces informations sont privées et nous permettent de vous contacter:
				hr
				mixin privateprofileForm()
				div.span8
					b Statistiques de votre profil:
					br
					br
					p#profilStats
		//script(src='http://maps.google.com/maps/api/js?v=3.9&sensor=false&libraries=drawing')				
		script
			var conf = !{conf};
			var user =!{JSON.stringify(user)};
			
			$(document).ready(function() {
			
				// init form
				$('#mail').val(user.mail);

				var profileStats = $("<div />");
				console.log(user.stats);
				if(typeof user.stats != 'undefined'){

					var output = [];
					if(typeof  user.stats.tags != 'undefined'){
						profileStats.append('Les tags qui vous intéressent:<br><ul>');
						var tags = user.stats.tags;
						output = [];
						for (var key in tags)
							output.push([key, tags[key],key+' (score='+tags[key]+')'])
						output.sort(function(a, b) {return b[1] - a[1]})

						
						$.each(output,function(key,val){
							profileStats.append('<li>'+val[2]+'</li>');
						})
						profileStats.append('</ul>');
					}	
					
					if(typeof user.stats.cats != 'undefined'){
						output = [];
						profileStats.append('<br>Les catégories qui vous intéressent:<br><ul>');
						var cats = user.stats.cats;
						console.log(cats);
						for (var key in cats)
							output.push([key, cats[key],key+' (score='+cats[key]+')'])
						output.sort(function(a, b) {return b[1] - a[1]})

						
						$.each(output,function(key,val){
							profileStats.append('<li>'+val[2]+'</li>');
						})
						profileStats.append('</ul>');

						
					}
				}
				$("#profilStats").append(profileStats);	
				
			}); // END READY	

